{% extends "base.html" %}

{% block title %}Shopping Cart - Protein Perks{% endblock %}

{% block content %}

<div class="max-w-7xl mx-auto px-4 py-12">

  <h1 class="text-4xl font-bold mb-8">Shopping Cart</h1>

  {% if cart_items %}

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

    <!-- CART ITEMS -->
    <div class="lg:col-span-2 bg-white shadow rounded-lg">

      {% for item in cart_items %}

      <div class="flex items-center gap-4 p-6 border-b">

        <!-- IMAGE -->
        <div class="w-24 h-24 bg-gray-100 rounded flex items-center justify-center">
          <span class="text-gray-400 text-sm">IMG</span>
        </div>

        <!-- DETAILS -->
        <div class="flex-1">

          <h3 class="font-semibold text-lg">
            {{ item.product.name }}
          </h3>

          <p class="text-gray-600 text-sm">
            {{ item.product.brand }} | {{ item.product.weight }}
          </p>

          <p class="text-indigo-600 font-bold mt-1">
            ₹{{ item.product.price }}
          </p>

        </div>

        <!-- QUANTITY -->
        <div class="flex items-center gap-2">

          <button
            class="qty-btn px-3 py-1 border rounded"
            data-id="{{ item.product.id }}"
            data-qty="{{ item.quantity - 1 }}">
            -
          </button>

          <span class="font-semibold px-3">
            {{ item.quantity }}
          </span>

          <button
            class="qty-btn px-3 py-1 border rounded"
            data-id="{{ item.product.id }}"
            data-qty="{{ item.quantity + 1 }}">
            +
          </button>

        </div>

        <!-- REMOVE -->
        <button
          class="remove-btn text-red-600 ml-4"
          data-id="{{ item.product.id }}">
          Remove
        </button>

        <!-- SUBTOTAL -->
        <div class="text-right ml-6">

          <p class="text-sm text-gray-500">
            Subtotal
          </p>

          <p class="font-bold">
            ₹{{ item.subtotal }}
          </p>

        </div>

      </div>

      {% endfor %}

    </div>


    <!-- SUMMARY -->
    <div class="bg-white shadow rounded-lg p-6 sticky top-20">

      <h2 class="text-xl font-bold mb-4">
        Order Summary
      </h2>

      <div class="space-y-2 mb-4">

        <div class="flex justify-between">
          <span>Subtotal</span>
          <span>₹{{ total }}</span>
        </div>

        <div class="flex justify-between">
          <span>Shipping</span>
          <span class="text-green-600">FREE</span>
        </div>

        <div class="flex justify-between font-bold text-lg border-t pt-2">
          <span>Total</span>
          <span class="text-indigo-600">₹{{ total }}</span>
        </div>

      </div>

      <a href="/checkout"
         class="block w-full bg-indigo-600 text-white text-center py-2 rounded mb-3">

        Proceed to Checkout

      </a>

      <a href="/products"
         class="block w-full border text-center py-2 rounded">

        Continue Shopping

      </a>

    </div>

  </div>

  {% else %}

  <!-- EMPTY CART -->

  <div class="bg-white shadow rounded-lg text-center p-12">

    <h2 class="text-2xl font-bold mb-3">
      Your cart is empty
    </h2>

    <p class="text-gray-600 mb-6">
      Add some products to start shopping.
    </p>

    <a href="/products"
       class="bg-indigo-600 text-white px-6 py-2 rounded">

      Browse Products

    </a>

  </div>

  {% endif %}

</div>


<!-- JAVASCRIPT -->

<script>

document.addEventListener("DOMContentLoaded", function () {

  // Quantity Buttons
  document.querySelectorAll(".qty-btn").forEach(btn => {

    btn.addEventListener("click", async function () {

      let id = this.dataset.id;
      let qty = parseInt(this.dataset.qty);

      if (qty < 1) return;

      const formData = new FormData();
      formData.append("product_id", id);
      formData.append("quantity", qty);

      await fetch("/cart/update", {
        method: "POST",
        body: formData
      });

      location.reload();

    });

  });


  // Remove Buttons
  document.querySelectorAll(".remove-btn").forEach(btn => {

    btn.addEventListener("click", async function () {

      let id = this.dataset.id;

      const formData = new FormData();
      formData.append("product_id", id);

      const res = await fetch("/cart/remove", {
        method: "POST",
        body: formData
      });

      const data = await res.json();

      if (data.success) {
        location.reload();
      } else {
        alert("Remove failed");
      }

    });

  });

});

</script>


{% endblock %}
